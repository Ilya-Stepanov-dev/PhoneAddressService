# üì± Phone Address Service

C–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –Ω–æ–º–µ—Ä–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ –∏—Ö –∞–¥—Ä–µ—Å–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **FastAPI** –∏ **Redis**.

---

## üéØ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

### –ó–∞–¥–∞—á–∞

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å REST API —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- **–°–æ–∑–¥–∞–≤–∞—Ç—å** –∑–∞–ø–∏—Å–∏ —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –∞–¥—Ä–µ—Å–æ–º
- **–ü–æ–ª—É—á–∞—Ç—å** –∞–¥—Ä–µ—Å –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- **–û–±–Ω–æ–≤–ª—è—Ç—å** –∞–¥—Ä–µ—Å –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –Ω–æ–º–µ—Ä–∞
- **–£–¥–∞–ª—è—Ç—å** –∑–∞–ø–∏—Å–∏ –ø–æ –Ω–æ–º–µ—Ä—É
- **–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å** –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ (—Ä—É—Å—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)


### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ Pydantic
- Docker –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|-----------|
| **Web Framework** | FastAPI |
| **Async Runtime** | asyncio |
| **Cache** | Redis |
| **Validation** | Pydantic v2 |
| **Deployment** | Docker |
| **Config** | Pydantic Settings |
| **Logging** | Python logging |

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
project/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ config/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py       # Redis –∏ Service –∫–æ–Ω—Ñ–∏–≥
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ log.py          # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ routes/             # REST API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.py       # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ response.py     # HTTP –æ—Ç–≤–µ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ types.py            # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–∏–ø—ã (RussianPhone)
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py          # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ services.py         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py       # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ depends.py          # Dependency Injection
‚îÇ   ‚îú‚îÄ‚îÄ redis_manager.py    # Redis —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ main.py             # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker Compose
‚îî‚îÄ‚îÄ pyproject.toml          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. **–ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç–∏–ø RussianPhone** (`app/types.py`)

–í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –ª—é–±–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –∫ `8XXXXXXXXXX`:

```python
from pydantic import PlainValidator

def validate_russian_phone(value: str) -> str:
    # –£–¥–∞–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç +7/7 ‚Üí 8
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–ª–∏–Ω—É (11 —Ü–∏—Ñ—Ä)
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä

RussianPhone = Annotated[str, PlainValidator(validate_russian_phone)]
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- `+79991234567` ‚Üí `89991234567`
- `89991234567` ‚Üí `89991234567`
- `79991234567` ‚Üí `89991234567`
- `+7-999-123-45-67` ‚Üí `89991234567`
- `+7 (999) 123-45-67` ‚Üí `89991234567`

#### 2. **Redis Manager** (`app/redis_manager.py`)

–£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Redis:

```python
class RedisManager:
    - connect()
    - disconnect()
    - get_connection()
```

#### 3. **Service Layer** (`app/services.py`)

–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏:

```python
class PhoneAddressService:
    - get_address(phone: str) ‚Üí str
    - create_address(phone: str, address: str)
    - update_address(phone: str, address: str, save_ttl: bool)
    - delete_address(phone: str)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- Redis –∫–ª—é—á–∏: `phone:89991234567`
- TTL: 1 —á–∞—Å (configurable)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

#### 4. **REST API** (`app/routes/routes.py`)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|---------|
| **GET** | `/api/phone/{phone}` | –ü–æ–ª—É—á–∏—Ç—å –∞–¥—Ä–µ—Å |
| **POST** | `/api/phone` | –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å |
| **PUT** | `/api/phone/{phone}` | –û–±–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å |
| **DELETE** | `/api/phone/{phone}` | –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å |

#### 5. **Exception Handling** (`app/exceptions.py`)

–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ HTTP —Å—Ç–∞—Ç—É—Å–∞–º–∏:

- `PhoneNotFoundError` ‚Üí 404
- `PhoneAlreadyExistsError` ‚Üí 409
- `InvalidPhoneFormatError` ‚Üí 400
- `RedisConnectionError` ‚Üí 500


## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### Docker

#### –ó–∞–ø—É—Å–∫

```bash
make run-docker
# –∏–ª–∏
docker compose up -d
```

#### –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
make stop
# –∏–ª–∏
docker compose down
```
